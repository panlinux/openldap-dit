# slapd.conf template
include	@SCHEMADIR@/core.schema
include	@SCHEMADIR@/cosine.schema
include	@SCHEMADIR@/corba.schema 
include	@SCHEMADIR@/inetorgperson.schema
include	@SCHEMADIR@/java.schema 
include	@SCHEMADIR@/krb5-kdc.schema
include @SCHEMADIR@/kerberosobject.schema
include	@SCHEMADIR@/misc.schema
include	@SCHEMADIR@/nis.schema
include	@SCHEMADIR@/openldap.schema 
include @SCHEMADIR@/autofs.schema
include @SCHEMADIR@/samba.schema
include @SCHEMADIR@/kolab.schema
include @SCHEMADIR@/evolutionperson.schema
include @SCHEMADIR@/calendar.schema
include @SCHEMADIR@/sudo.schema
include @SCHEMADIR@/dnszone.schema
include @SCHEMADIR@/dhcp.schema
include @SCHEMADIR@/dyngroup.schema
include @SCHEMADIR@/ppolicy.schema
include @SCHEMADIR@/kde.schema

pidfile		@RUNDIR@/slapd.pid
argsfile	@RUNDIR@/slapd.args

modulepath	@LDAPLIBDIR@
moduleload	back_monitor.la
moduleload  back_bdb.la
moduleload	syncprov.la
moduleload	ppolicy.la
#moduleload	refint.la
#moduleload	unique.la

#TLSCertificateFile      /etc/ssl/openldap/ldap.pem
#TLSCertificateKeyFile   /etc/ssl/openldap/ldap.pem
#TLSCACertificateFile    /etc/ssl/openldap/ldap.pem

#loglevel 256

database	bdb
suffix		"@SUFFIX@"
directory	/var/lib/ldap
rootdn		"cn=manager,@SUFFIX@"

checkpoint 256 5
# 32Mbytes, can hold about 10k posixAccount entries
dbconfig set_cachesize 0 33554432 1
dbconfig set_lg_bsize 2097152
cachesize 1000
idlcachesize 3000

index	objectClass					eq
index	uidNumber,gidNumber,memberuid,member		eq
index	uid						eq,subinitial
index	cn,mail,surname,givenname			eq,subinitial
index	sambaSID					eq,sub
index	sambaDomainName,displayName,sambaGroupType	eq
index	sambaSIDList					eq
index	krb5PrincipalName				eq
index	uniqueMember					pres,eq
index	zoneName,relativeDomainName			eq
index	sudouser					eq,sub
index	entryCSN,entryUUID				eq
index	dhcpHWAddress,dhcpClassData			eq

overlay syncprov
syncprov-checkpoint 100 10
syncprov-sessionlog 100

overlay ppolicy
ppolicy_default "cn=default,ou=Password Policies,@SUFFIX@"

# uncomment if you want to automatically update group
# memberships when an user is removed from the tree
# Also uncomment the refint.la moduleload above
#overlay refint
#refint_attributes member
#refint_nothing "uid=LDAP Admin,ou=System Accounts,@SUFFIX@"

# Example of unique overlay configuration.
# Uncomment if you want to enforce uniqueness of the listed attributes under
# that tree. Also uncomment the unique.la module load above.
# Beware of using gidNumber as unique: some setups use the
# same group for all users instead of private groups.
#overlay unique
#unique_base ou=People,@SUFFIX@
#unique_attributes uidNumber,uid

authz-regexp "gidNumber=0\\\+uidNumber=0,cn=peercred,cn=external,cn=auth"
	"uid=Account Admin,ou=System Accounts,@SUFFIX@"
authz-regexp ^uid=([^,]+),cn=[^,]+,cn=auth$ uid=$1,ou=People,@SUFFIX@

include @LDAPCONFDIR@/openldap-dit-access.conf

database monitor
access to dn.subtree="cn=Monitor"
	by group.exact="cn=LDAP Monitors,ou=System Groups,@SUFFIX@" read
	by group.exact="cn=LDAP Admins,ou=System Groups,@SUFFIX@" read
	by * none

